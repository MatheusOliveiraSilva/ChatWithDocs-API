{
    "family": "chatmemoryapi-task",
    "executionRoleArn": "arn:aws:iam::248189927293:role/ecsTaskExecutionRole",
    "networkMode": "awsvpc",
    "containerDefinitions": [
      {
        "name": "db",
        "image": "postgres:15",
        "cpu": 256,
        "memory": 512,
        "essential": false,
        "environment": [
          { "name": "POSTGRES_USER", "value": "${POSTGRES_USER}" },
          { "name": "POSTGRES_PASSWORD", "value": "${POSTGRES_PASSWORD}" },
          { "name": "POSTGRES_DB", "value": "${POSTGRES_DB}" }
        ],
        "portMappings": [
          {
            "containerPort": 5432,
            "hostPort": 5432,
            "protocol": "tcp"
          }
        ]
      },
      {
        "name": "api",
        "image": "${ECR_REPOSITORY_URI}:${IMAGE_TAG}",
        "cpu": 256,
        "memory": 512,
        "essential": true,
        "environment": [
          { "name": "DATABASE_URL", "value": "${DATABASE_URL}" },
          { "name": "MIDDLEWARE_SECRET_KEY", "value": "${MIDDLEWARE_SECRET_KEY}" },
          { "name": "AUTH0_DOMAIN", "value": "${AUTH0_DOMAIN}" },
          { "name": "AUTH0_CLIENT_ID", "value": "${AUTH0_CLIENT_ID}" },
          { "name": "AUTH0_CLIENT_SECRET", "value": "${AUTH0_CLIENT_SECRET}" },
          { "name": "FRONTEND_URL", "value": "${FRONTEND_URL}" },
          { "name": "API_URL", "value": "${API_URL}" },
          { "name": "ANTHROPIC_API_KEY", "value": "${ANTHROPIC_API_KEY}" },
          { "name": "OPENAI_API_KEY", "value": "${OPENAI_API_KEY}" },
          { "name": "S3_BUCKET_NAME", "value": "${S3_BUCKET_NAME}" },
          { "name": "S3_ACCESS_KEY", "value": "${S3_ACCESS_KEY}" },
          { "name": "S3_SECRET_KEY", "value": "${S3_SECRET_KEY}" },
          { "name": "S3_REGION", "value": "${S3_REGION}" },
          { "name": "PINECONE_API_KEY", "value": "${PINECONE_API_KEY}" },
          { "name": "POSTGRES_USER", "value": "${POSTGRES_USER}" },
          { "name": "POSTGRES_PASSWORD", "value": "${POSTGRES_PASSWORD}" },
          { "name": "POSTGRES_DB", "value": "${POSTGRES_DB}" },
          { "name": "AWS_ACCESS_KEY_ID", "value": "${AWS_ACCESS_KEY_ID}" },
          { "name": "AWS_SECRET_ACCESS_KEY", "value": "${AWS_SECRET_ACCESS_KEY}" },
          { "name": "AWS_REGION", "value": "${AWS_REGION}" }
        ],
        "portMappings": [
          {
            "containerPort": 8000,
            "hostPort": 8000,
            "protocol": "tcp"
          }
        ],
        "logConfiguration": {
          "logDriver": "awslogs",
          "options": {
            "awslogs-group": "/ecs/chatmemoryapi-task",
            "awslogs-region": "${AWS_REGION}",
            "awslogs-stream-prefix": "ecs"
          }
        }
      }
    ],
    "requiresCompatibilities": ["FARGATE"],
    "cpu": "512",
    "memory": "1024"
  }
  